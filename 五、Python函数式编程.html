<html>
<head>
  <title>五、Python函数式编程</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="698"/>
<h1>五、Python函数式编程</h1>

<div>
<span><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">十、</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">函数式编程</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1.函数式编程三大特性：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">immutable data 不可变数据</span></div><div><span style="font-size: 16pt; font-family: 楷体;">first class functions：函数像变量一样使用</span></div><div><span style="font-size: 16pt; font-family: 楷体;">尾递归优化：每次递归都重用stack</span></div><div><span style="font-size: 16pt; font-family: 楷体;">好处：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">parallelization 并行</span></div><div><span style="font-size: 16pt; font-family: 楷体;">lazy evaluation 惰性求值</span></div><div><span style="font-size: 16pt; font-family: 楷体;">determinism 确定性</span></div><div><span style="font-size: 16pt; font-family: 楷体;">内套函数：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">def inc(x):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    print(&quot;x = %d&quot; % x)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    def incx(y):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        print(&quot;y = %d&quot; % y)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        return x+y</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    return incx</span></div><div><span style="font-size: 16pt; font-family: 楷体;">inc2 = inc(2)#参数是x的值，返回值做为内层函数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(inc2)#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">内层函数的地址</span></div><div><span style="font-size: 16pt; font-family: 楷体;">&lt;function inc.&lt;locals&gt;.incx at 0x000000000238B158&gt;</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(inc2(3))#参数3是内层函数y的值</span></div><div><span style="font-size: 16pt; font-family: 楷体;">x = 2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">&lt;function inc.&lt;locals&gt;.incx at 0x000000000238B158&gt;</span></div><div><span style="font-size: 16pt; font-family: 楷体;">y = 3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">2.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">lambda</span><span style="font-size: 16pt; font-family: 楷体;">匿名函数（跟c语言的define类似）</span></div><div><span style="font-size: 16pt; font-family: 楷体;">g = lambda x:x*2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">k = lambda x,y:x+y</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(g(3))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(k(2,4))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print((lambda z:z+5)(7))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">匿名函数直接带参数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">12</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">3.</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">map</span><span style="font-size: 16pt; font-family: 楷体;">(function,sequence):对sequence中的item依次执行function(item),执行结果组成一个List返回</span></div><div><span style="font-size: 16pt; font-family: 楷体;">name_len = list(map(len,[&quot;123&quot;,&quot;2345&quot;,&quot;453656&quot;]))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">python3中必须将map转换成list</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(type(name_len))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">&lt;class 'list'&gt;</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(name_len)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[3, 4, 6]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">def toUpper(item):#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">定义一个将所有字符转换成大写的函数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    return item.upper()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">upper_name = list(map(toUpper,['3df','dfd']))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(upper_name)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">['3DF', 'DFD']</span></div><div><span style="font-size: 16pt; font-family: 楷体;">items = [1,3,5,6,7]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">squared = list(map(lambda x:x**2,items))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(squared)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[1, 9, 25, 36, 49]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">4.</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">reduce(function,sequence,starting_value)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">二元操作函数</span><span style="font-size: 16pt; font-family: 楷体;">对sequence中的item顺序迭代调用function,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#如果有starting_value,还可以作为初始值调用</span></div><div><span style="font-size: 16pt; font-family: 楷体;">import functools    #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">reduce</span><span style="font-size: 16pt; font-family: 楷体;">是类</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">functools</span><span style="font-size: 16pt; font-family: 楷体;">的方法</span></div><div><span style="font-size: 16pt; font-family: 楷体;">def add(x,y):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    return x+y</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(functools.reduce(add,range(1,5)))#</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">range是左闭右开</span></div><div><span style="font-size: 16pt; font-family: 楷体;">10    #</span><span style="font-size: 16pt; font-family: 楷体;">1+2+3+4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(functools.reduce(add,range(1,5),2))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">12    </span><span style="font-size: 16pt; font-family: 楷体;">#2+1+2+3+4</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">5.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">filter</span><span style="font-size: 16pt; font-family: 楷体;">(function,sequence)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">筛选器</span><span style="font-size: 16pt; font-family: 楷体;">，对sequence中item依次执行function(item)，</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#将执行结果为True的item组成一个List/String/Tuple(取决于sequence的类型)返回</span></div><div><span style="font-size: 16pt; font-family: 楷体;">number_list = list(range(-5,5))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(number_list)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[-5, -4, -3, -2, -1, 0, 1, 2, 3, 4]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">less_than_zero = list(filter(lambda x:x&lt;0,number_list))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(less_than_zero)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[-5, -4, -3, -2, -1]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">高阶函数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#可以把别的</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">函数作为参数传入的函数</span><span style="font-size: 16pt; font-family: 楷体;">叫高阶函数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#变量和函数都是object对象</span></div><div><span style="font-size: 16pt; font-family: 楷体;">func = abs</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(func(-10))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#函数本身就是可以作为一个变量。那我们的变量是可以作为另一个函数的参数的，那么一个函数也可以作为另一个函数的参数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">def addabs(a,b,func):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    return func(a) + func(b)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(addabs(10,-10,func))</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7.wrapper</span><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">装饰器</span></div><div><span style="font-size: 16pt; font-family: 楷体;">def hello(fn):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    def wrapper():</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        print(&quot;hello, %s&quot; % fn.__name__)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        fn()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        print(&quot;goodby, %s&quot; % fn.__name__)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    return wrapper</span></div><div><span style="font-size: 16pt; font-family: 楷体;">@hello</span></div><div><span style="font-size: 16pt; font-family: 楷体;">def foo():</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    print(&quot;i am foo&quot;)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">foo()</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#运行结果</span></div><div><span style="font-size: 16pt; font-family: 楷体;">hello, foo</span></div><div><span style="font-size: 16pt; font-family: 楷体;">i am foo</span></div><div><span style="font-size: 16pt; font-family: 楷体;">goodby, foo</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">Partial function</span> <span style="font-size: 16pt; font-family: 楷体;">偏函数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#偏函数又可以翻译成部分函数，大概意思就是说，只设置一部分参数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">例如：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">def int2(x, base=2):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    return int(x, base)#int默认的base是十进制</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(int2('101'))#默认的进制数是2</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#functools.partial就是帮助我们创建一个偏函数</span></div><div><span style="font-size: 16pt; font-family: 楷体;">import functools</span></div><div><span style="font-size: 16pt; font-family: 楷体;">int2 = functools.partial(int, base=2)#</span><span style="font-size: 16pt; font-family: 楷体;">将int的base参数固定成2</span></div></span>
</div></body></html> 