<html>
<head>
  <title>七、Python文件操作</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="696"/>
<h1>七、Python文件操作</h1>

<div>
<span><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">十二、文件操作</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1.读取文件的函数</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">read</span><span style="font-size: 16pt; font-family: 楷体;">()将文本文件所有行读到一个字符串中。</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">readline</span><span style="font-size: 16pt; font-family: 楷体;">()是一行一行的读。</span><span style="font-size: 16pt; font-family: 楷体;">readline()可以在读行过程中跳过特定行。</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">readlines</span><span style="font-size: 16pt; font-family: 楷体;">()是将文本文件中所有行读到一个list中，文本文件每一行是list的一个元素。 </span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">2.读文件的有3个方法</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#第一种方法：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f = open(&quot;1.txt&quot;)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">line = f.read()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(line)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f.close()#open后需要记得close</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">f = open(&quot;1.txt&quot;)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">lines = f.readline()#一行包括换行符</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(lines)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f.close()</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">f = open(&quot;1.txt&quot;)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">hang = f.readlines()#每行是list的一个元素，每行也包括换行符</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(hang)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f.close()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#第二种方法：</span></div><div><span style="font-size: 21px; font-family: 楷体; line-height: 30px;">#</span><span style="font-size: 16pt; font-family: 楷体; line-height: 30px;">文件迭代器，用for循环的方法</span></div><div><span style="font-size: 16pt; font-family: 楷体;">for line in open(&quot;1.txt&quot;):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    print(line)#这里可以进行逻辑处理</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#第三种方法：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#打开文件，用with open（）as file,自带关闭文本的功能</span></div><div><span style="font-size: 16pt; font-family: 楷体;">with open(&quot;test.txt&quot;,'r') as file:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    data = file.read()</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">3.</span><span style="font-size: 16pt; font-family: 楷体;">二进制文件读写</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f = open('1.jpg', 'rb')</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(f.read())</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f.close()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体;">非标准的文本文件（对于Py2来说，标准是ASCII，</span><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;">对于Py3来说，标准是unicode），需要用二进制读入这个文件。</span><span style="font-size: 16pt; font-family: 楷体; line-height: 1.45;">然后再用 .decode('...')的方法来解码这个二进制文件。</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f = open('1.txt', 'rb')</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(f.read().decode())</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f.close()</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">4.</span><span style="font-size: 16pt; font-family: 楷体;">文件和目录操作</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体;">Python内置的</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">os模块</span><span style="font-size: 16pt; font-family: 楷体;">直接调用操作系统提供的</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">接口函数</span><span style="font-size: 16pt; font-family: 楷体;">，实现文件和目录操作</span></div><div><span style="font-size: 16pt; font-family: 楷体;">import</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">os</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(os.name)#获得</span><span style="font-size: 16pt; font-family: 楷体;">操作系统的名字，</span><span style="font-size: 16pt; font-family: 楷体;">posix说明系统是#nix族，如果是nt，就是Windows</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(os.environ)#获得操作系统的环境变量（dict类型）。</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">path = os.path.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">abspath</span><span style="font-size: 16pt; font-family: 楷体;">('.')#<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">获得当前目录的绝对路径</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;"><span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);"><br/></span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">path1 = os.path.<font style="color: rgb(255, 0, 0);">join</font>(path, 'Pictures.jpg')#在绝对路径下添加创建路径</span></div><div><span style="font-family: 楷体; font-size: 16pt;">path_name = os.path.</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">join</span><span style="font-family: 楷体; font-size: 16pt;">(path, fileName)#</span><span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">添加目录</span></div><div><span style="font-size: 16pt; font-family: 楷体;"><br/></span></div><div><span style="font-size: 16pt; font-family: 楷体;">os.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">mkdir</span><span style="font-size: 16pt; font-family: 楷体;">(path1)#创建文件夹，</span><span style="font-size: 16pt; font-family: 楷体;">创建时如果文件夹已经存在，程序异常</span></div><div><span style="font-size: 16pt; font-family: 楷体;">os.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">rmdir</span><span style="font-size: 16pt; font-family: 楷体;">(path1)#删除文件夹，删除时如果文件件不存在，程序异常</span></div><div><span style="font-size: 16pt; font-family: 楷体;">os.path.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">split</span><span style="font-size: 16pt; font-family: 楷体;">(path)#返回值为元祖类型，拆分结果是目录的最后一层和之前的路径</span></div><div><span style="font-size: 16pt; font-family: 楷体;">os.path.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">splitext</span><span style="font-size: 16pt; font-family: 楷体;">(path1)#返回值是元祖类型，拆出的结果是文件的路径和扩展名</span></div><div><span style="font-size: 16pt; font-family: 楷体;">os.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">rename</span><span style="font-size: 16pt; font-family: 楷体;">(&quot;1.txt&quot;,&quot;3.txt&quot;)#文件重命名</span></div><div><span style="font-size: 16pt; font-family: 楷体;">os.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">remove</span><span style="font-size: 16pt; font-family: 楷体;">('3.txt'</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">)#删除文件</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">for file in</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">os.listdir</span><span style="font-size: 16pt; font-family: 楷体;">(path):#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">遍历路径path下的所有文件和文件夹</span></div><div><span style="font-size: 16pt; font-family: 楷体;">if os.path.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">isdir</span><span style="font-size: 16pt; font-family: 楷体;">(file_path):#</span><span style="font-size: 16pt; color: rgb(255, 70, 53); font-family: 楷体;">判断是否为目录</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">if os.path.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">isfile</span><span style="font-size: 16pt; font-family: 楷体;">(file_path): #</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">判断是否为文件</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">(filepath,tempfilename) = os.path.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">split</span><span style="font-size: 16pt; font-family: 楷体;">(file)#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">拆分文件路径和文件名</span></div><div><span style="font-size: 16pt; font-family: 楷体;">(filename,extension) = os.path.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">splitext</span><span style="font-size: 16pt; font-family: 楷体;">(tempfilename)#</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">拆分文件名和文件后缀名</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt;"><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">shutil库作为os库的补充</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">import shutil</span></div><div><span style="font-size: 16pt; font-family: 楷体;">shutil.copyfile(&quot;1.txt&quot;,&quot;2.txt&quot;)#<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">拷贝文件</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print([x for x in os.listdir('.') if os.path.isdir(x)])#</span><span style="font-size: 16pt;"><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">列出当前目录下的所有目录</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print([x for x in os.listdir('.') if os.path.isfile(x) and os.path.splitext(x)[1]=='.py'])</span><span style="font-size: 16pt; font-family: 楷体;"># <span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">列出所有的py文件</span></span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">5.序列化和反序列化</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#变量从内存中变成可以存储或传输的过程称之为序列化，在Python中叫做pickling</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#把变量内容从序列化的对象重新读取到内存中,称为反序列化，称之为unpickling</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#用Python的pickle实现序列化和反序列化</span></div><div><span style="font-size: 16pt; font-family: 楷体;">import</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">pickle</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#序列化</span></div><div><span style="font-size: 16pt; font-family: 楷体;"># 此处定义一个dict字典对象</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d = dict(name='思聪', age=29, score=80)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(d)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">str = pickle.dumps(d) # 调用pickle的dumps函数进行序列化处理</span></div><div><span style="font-size: 16pt; font-family: 楷体;"># 你可以看看它长什么样子</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(str)</span></div><div><span style="font-size: 16pt; font-family: 楷体;"># 定义和创建一个file文件对象，设定模式为wb</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f = open('dump.txt', 'wb')</span></div><div><span style="font-size: 16pt; font-family: 楷体;"># 将内容序列化写入到file文件中</span></div><div><span style="font-size: 16pt; font-family: 楷体;">pickle.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">dump</span><span style="font-size: 16pt; font-family: 楷体;">(d, f)#将序列化的内容写到dump.txt文件中</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f.close() # 最后关闭掉文件资源</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#反序列化</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#从之前序列化的dump.txt文件里边读取内容</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f = open('dump.txt', 'rb') # 设定文件选项模式为rb</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d = pickle.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">load</span><span style="font-size: 16pt; font-family: 楷体;">(f) # 调用load做反序列处理过程</span></div><div><span style="font-size: 16pt; font-family: 楷体;">f.close() # 关闭文件资源</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(d)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体;">python2和python3里面的</span><span style="font-size: 16pt; font-family: 楷体;">pickle不一样，</span><span style="font-size: 16pt; font-family: 楷体;">以下可以</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">兼容Python2和Python3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">try:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    import cPickle as pickle</span></div><div><span style="font-size: 16pt; font-family: 楷体;">except ImportError:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    import pickle</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#</span><span style="font-size: 16pt; font-family: 楷体;">用JSON实现序列化和反序列化</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">JSON类型     Python类型</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    {}         dict</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    []          list</span></div><div><span style="font-size: 16pt; font-family: 楷体;">&quot;string&quot; 'str'或者u'unicode'</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1234.56     int或float</span></div><div><span style="font-size: 16pt; font-family: 楷体;">true/false True/False</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    null         None</span></div><div><span style="font-size: 16pt; font-family: 楷体;">import</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">json</span></div><div><span style="font-size: 16pt; font-family: 楷体;">#定义dict字典对象</span></div><div><span style="font-size: 16pt; font-family: 楷体;">d = dict(name = '小丽',age = 20,score = 80)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(d)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">str = json.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">dumps</span><span style="font-size: 16pt; font-family: 楷体;">(d) #调用json的dumps函数进行json的序列化处理</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(str)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">dd = json.</span><span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">loads</span><span style="font-size: 16pt; font-family: 楷体;">(str)#调用json的loads函数进行反序列化处理</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(dd)</span></div></span>
</div></body></html> 