<html>
<head>
  <title>十一、机器学习实战（sklearn的svm）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="709"/>
<h1>十一、机器学习实战（sklearn的svm）</h1>

<div>
<span><div><span style="font-size: 16pt; font-family: 楷体;">from</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">sklearn</span> <span style="font-size: 16pt; font-family: 楷体;">import</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">svm</span><span style="font-size: 16pt; font-family: 楷体;">,</span> <span style="font-size: 16pt; color: rgb(255, 0, 0); font-family: 楷体;">datasets </span></div><div><span style="font-size: 16pt; font-family: 楷体;">import math</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">class Dataset:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    # <span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">我们创造一个dataset的类，这个类会帮我们下载相关的数据集</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">    # <span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">并给我们分类好x,y</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">    def __init__(self, name):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 告诉类，我们需要哪一个数据集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 我们有两个选择，一个是'iris'一个是'digits'</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        self.name = name</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    def download_data(self):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # <span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">从sklearn的自带集中下载我们指定的数据集</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">        if self.name == 'iris':</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            # 这里是sklearn自带的数据集下载方法，更多信息可以参照官网</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            self.downloaded_data = datasets.load_iris()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        elif self.name == 'digits':</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            self.downloaded_data = datasets.load_digits()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        else:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            # 如果不是我们预想的两种数据集，则报错</span></div><div><span style="font-size: 16pt; font-family: 楷体;">            print('Dataset Error: No named datasets')</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    </span></div><div><span style="font-size: 16pt; font-family: 楷体;">    def generate_xy(self):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 通过这个过程来把我们的数据集分为原始数据以及他们的label</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 我们先把数据下载下来</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        self.download_data()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        x = self.downloaded_data.data</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        y = self.downloaded_data.target</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        print('\nOriginal data looks like this: \n', x)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        print('\nLabels looks like this: \n', y)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        return x,y</span></div><div><span style="font-size: 16pt; font-family: 楷体;">    </span></div><div><span style="font-size: 16pt; font-family: 楷体;">    def get_train_test_set(self, ratio):</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 这里，我们把所有的数据分成训练集和测试集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 一个参数要求我们告知，我们以多少的比例来分割训练和测试集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 首先，我们把XY给generate出来：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        x, y = self.generate_xy()</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 有个比例，我们首先得知道 一共有多少的数据</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        n_samples = len(x)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        print(n_samples)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 于是我们知道，有多少应该是训练集，多少应该是测试集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        n_train = n_samples * ratio</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        print(math.floor(n_train))#<span style="font-family: 楷体; font-size: 16pt; color: rgb(255, 0, 0);">math.floor(x)向下取整、math.ceil(x)向上取整、round(x)四舍五入</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 好了，接下来我们分割数据</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        X_train = x[:math.floor(n_train)]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        y_train = y[:math.floor(n_train)]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        X_test = x[math.floor(n_train):]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        y_test = y[math.floor(n_train):]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        # 好，我们得到了所有想要的玩意儿</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        return X_train, y_train, X_test, y_test</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;"># 比如，我们使用digits数据集</span></div><div><span style="font-size: 16pt; font-family: 楷体;">data = Dataset('digits')</span></div><div><span style="font-size: 16pt; font-family: 楷体;"># 接着，我们可以用0.7的分割率把xy给分割出来</span></div><div><span style="font-size: 16pt; font-family: 楷体;">X_train, y_train, X_test, y_test = data.get_train_test_set(0.7)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(X_train)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(y_train)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(X_test)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(y_test)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">clf = svm.SVC()    #<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">创建SVM分类器的实例</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(clf.fit(X_train, y_train))#<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">训练数据</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">#<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">随便选取的测试点</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">test_point = [X_test[13]]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">y_true = y_test[13]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(test_point)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(y_true)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">y_predict =clf.predict(test_point)#<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">预测y的预测值</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">print(y_predict)</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">运行结果：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">Original data looks like this:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[[  0.   0.   5. ...,   0.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   0. ...,  10.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   0. ...,  16.   9.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">...,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   1. ...,   6.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   2. ...,  12.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.  10. ...,  12.   1.   0.]]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">Labels looks like this:</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[0 1 2 ..., 8 9 8]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">1797</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1257</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">[[  0.   0.   5. ...,   0.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   0. ...,  10.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   0. ...,  16.   9.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">...,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   0. ...,   3.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   5. ...,  11.   3.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   3. ...,   0.   0.   0.]]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">[0 1 2 ..., 4 3 1]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">[[  0.   0.   0. ...,   0.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   5. ...,   3.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   7.  16. ...,   0.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">...,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   1. ...,   6.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.   2. ...,  12.   0.   0.]</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[  0.   0.  10. ...,  12.   1.   0.]]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">[4 0 5 3 6 9 6 1 7 5 4 4 7 2 8 2 2 5 7 9 5 4 8 8 4 9 0 8 9 8 0 1 2 3 4 5 6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 9 5 5 6 5 0 9 8 9 8 4 1 7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7 3 5 1 0 0 2 2 7 8 2 0 1 2 6 3 3 7 3 3 4 6 6 6 4 9 1 5 0 9 5 2 8 2 0 0 1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7 6 3 2 1 7 4 6 3 1 3 9 1 7 6 8 4 3 1 4 0 5 3 6 9 6 1 7 5 4 4 7 2 8 2 2 5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7 9 5 4 8 8 4 9 0 8 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7 8 9 0 9 5 5 6 5 0 9 8 9 8 4 1 7 7 3 5 1 0 0 2 2 7 8 2 0 1 2 6 3 3 7 3 3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">4 6 6 6 4 9 1 5 0 9 5 2 8 2 0 0 1 7 6 3 2 1 7 4 6 3 1 3 9 1 7 6 8 4 3 1 4</span></div><div><span style="font-size: 16pt; font-family: 楷体;">0 5 3 6 9 6 1 7 5 4 4 7 2 8 2 2 5 7 9 5 4 8 8 4 9 0 8 9 8 0 1 2 3 4 5 6 7</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8 9 0 1 2 3 4 5 6 9 0 1 2 3 4 5 6 7 8 9 0 9 5 5 6 5 0 9 8 9 8 4 1 7 7 3 5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">1 0 0 2 2 7 8 2 0 1 2 6 3 3 7 3 3 4 6 6 6 4 9 1 5 0 9 5 2 8 0 1 7 6 3 2 1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7 4 6 3 1 3 9 1 7 6 8 4 3 1 4 0 5 3 6 9 6 1 7 5 4 4 7 2 2 5 7 9 5 4 4 9 0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">8 9 8 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 9 5 5</span></div><div><span style="font-size: 16pt; font-family: 楷体;">6 5 0 9 8 9 8 4 1 7 7 3 5 1 0 0 2 2 7 8 2 0 1 2 6 3 3 7 3 3 4 6 6 6 4 9 1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">5 0 9 5 2 8 2 0 0 1 7 6 3 2 1 7 4 6 3 1 3 9 1 7 6 8 4 3 1 4 0 5 3 6 9 6 1</span></div><div><span style="font-size: 16pt; font-family: 楷体;">7 5 4 4 7 2 8 2 2 5 7 9 5 4 8 8 4 9 0 8 9 8]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">SVC(C=1.0, cache_size=200, class_weight=None, coef0=0.0,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  decision_function_shape='ovr', degree=3, gamma='auto', kernel='rbf',</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  max_iter=-1, probability=False, random_state=None, shrinking=True,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  tol=0.001, verbose=False)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[array([  0.,   2.,  13.,  16.,  10.,   0.,   0.,   0.,   0.,   6.,  13.,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">        10.,  16.,   0.,   0.,   0.,   0.,   0.,   0.,   8.,  14.,   0.,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         0.,   0.,   0.,   0.,   1.,  14.,   9.,   0.,   0.,   0.,   0.,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         0.,   9.,  14.,   1.,   0.,   0.,   0.,   0.,   1.,  14.,   7.,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         0.,   0.,   1.,   0.,   0.,   4.,  16.,   5.,   7.,  12.,  14.,</span></div><div><span style="font-size: 16pt; font-family: 楷体;">         0.,   0.,   3.,  15.,  16.,  16.,  10.,   1.,   0.])]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">2</span></div><div><span style="font-size: 16pt; font-family: 楷体;">[2]</span></div><div><br/></div><div><span style="font-size: 16pt; font-family: 楷体;">#<span style="font-size: 16pt; font-family: 楷体; color: rgb(255, 0, 0);">SVM参数含义</span></span></div><div><span style="font-size: 16pt; font-family: 楷体;">参数：</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  C：C-SVC的惩罚参数C 默认值是1.0</span></div><div><span style="font-size: 16pt; font-family: 楷体;">C越大，相当于惩罚松弛变量，希望松弛变量接近0，即对误分类的惩罚增大，趋向于对训练集全分对的情况，这样对训练集测试时准确率很高，但泛化能力弱。C值小，对误分类的惩罚减小，允许容错，将他们当成噪声点，泛化能力较强。</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  kernel ：核函数，默认是rbf，可以是‘linear’, ‘poly’, ‘rbf’, ‘sigmoid’, ‘precomputed’</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  　　0 – 线性：u'v</span></div><div><span style="font-size: 16pt; font-family: 楷体;">　　 1 – 多项式：(gamma*u'*v + coef0)^degree</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  　　2 – RBF函数：exp(-gamma|u-v|^2)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  　　3 –sigmoid：tanh(gamma*u'*v + coef0)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  degree ：多项式poly函数的维度，默认是3，选择其他核函数时会被忽略。</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  gamma ： ‘rbf’,‘poly’ 和‘sigmoid’的核函数参数。默认是’auto’，则会选择1/n_features</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  coef0 ：核函数的常数项。对于‘poly’和 ‘sigmoid’有用。</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  probability ：是否采用概率估计？.默认为False</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  shrinking ：是否采用shrinking heuristic方法，默认为true</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  tol ：停止训练的误差值大小，默认为1e-3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  cache_size ：核函数cache缓存大小，默认为200</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  class_weight ：类别的权重，字典形式传递。设置第几类的参数C为weight*C(C-SVC中的C)</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  verbose ：允许冗余输出？</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  max_iter ：最大迭代次数。-1为无限制。</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  decision_function_shape ：‘ovo’, ‘ovr’ or None, default=None3</span></div><div><span style="font-size: 16pt; font-family: 楷体;">  random_state ：数据洗牌时的种子值，int值</span></div><div><span style="font-size: 16pt; font-family: 楷体;">主要调节的参数有：C、kernel、degree、gamma、coef0。</span></div><div><br/></div><div><br style="font-family: 楷体; font-size: 16pt;"/></div></span>
</div></body></html> 